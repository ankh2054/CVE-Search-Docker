## CVE Search Docker

This CVE container will be un using jwilder-nginx-proxy, so the webserver will be run from port 5000 as default.

However the follopwing changes will happen.

SSL set to False in https://github.com/cve-search/CVE-Search-Docker/blob/master/docker/files/cve_search/configuration.ini
the install.sh will be reomved from running - CVE-Search-Docker/docker/files/cve_search/install.sh ( this only installs certificate which is not required as all requests will be proxied via nginx-proxy)


## To Manuall Buld and run 


### Building the containers

#### CVE Search 

```
docker build -f docker/images/cve_search/dockerfile-cve_search \
--build-arg "REPO=cve-search/cve-search" \
--build-arg "BRANCH=master" \
-t cve_search .
```

#### Redis

```
docker build -f docker/images/redis/dockerfile-redis  \
-t cve_search-redis .
```


#### Mongo

```
docker build -f docker/images/mongodb/dockerfile-mongo  \
-t cve_search-mongo .
```


### Running the containers

Important to run in this order.
- Redis
- Mongo
- CVE-search 

```
docker run --network=sentnl-net  --name redis --expose 6379  \
-d -v $(pwd)/.cve_search_data/cve_search_redis:/data \
cve_search-redis
```

```
docker run --network=sentnl-net  --name mongo --expose 27017  \
-d -v $(pwd)/.cve_search_data/cve_search_mongodb:/data/db \
cve_search-mongo
```

```
docker run --network=sentnl-net  --name cve_search --expose 5000 \
-d -e "VIRTUAL_HOST=vuln.sentnl.io" \
-e "LETSENCRYPT_HOST=vuln.sentnl.io" \
-e "LETSENCRYPT_EMAIL=charles.holtzkampf@gmail.com" \
-e "PYTHONUNBUFFERED=TRUE" \
-v $(pwd)/.cve_search_data/cve_search_mongodb:/data/db \
cve_search
```

##### General

In the root of this repo there is a docker-compose.yml file that can be used
to build and run the required containers for CVE Search.



You will need to [install docker-compose](https://docs.docker.com/compose/install/)
in order to perform this option.

Simply clone the repo, move into the root of the cloned repo and run the command:
~~~
docker-compose up 
~~~

The first time the mongodb container is started the database will be populated
from the mongodb dump. This might take a minute or two. During the population
the webinterface might have difficulty establishing connection to the mongodb.
Once done populating the connection should be restored automatically and the  
webserver should function normally.

The mongo and redis containers are configured to persist their data to the hosts'
file system; a .cve_search_data folder will be created when the containers are started.

The cve_search instance should be available under https://localhost



### Included in this repo

 - Mongodb database dump exported via the `docker/files/mongodb/data_dump_compress.sh` script;
 - Redis db dump of the Redis CPE db;

### Updating

When a new update is pulled from the repo it is recommended to 
- remove the .cve_search_data folder;
- rebuild the docker images completely.


### Changes
