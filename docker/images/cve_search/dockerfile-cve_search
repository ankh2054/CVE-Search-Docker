FROM python:latest

# Set an environment variable with the directory
# where we'll be running the app
ENV APP /app

# Create the directory and instruct Docker to operate
# from there from now on
RUN mkdir $APP
WORKDIR $APP

ARG REPO
ARG BRANCH

#Install cron for later use
RUN apt-get update \
    && apt-get install -y cron \
    && apt-get autoremove -y

RUN echo "Using repo - branch: $REPO - $BRANCH"

RUN git clone -b $BRANCH --single-branch https://github.com/$REPO.git ./

# Install the dependencies
RUN pip install -r requirements.txt


# Add files
ADD ./docker/files/cve_search/configuration.ini etc/.
ADD ./docker/files/cve_search/cve.png web/static/img/.
ADD ./docker/files/cve_search/cron-update .

#Create cron task to update CVE
RUN chmod 0644 /app/cron-update && \
    crontab /app/cron-update 
    

EXPOSE 5000
# Start cron to ensure cron runs updater.
RUN service cron start

# run the command to start the webserver
CMD ["python", "/app/web/index.py"]
